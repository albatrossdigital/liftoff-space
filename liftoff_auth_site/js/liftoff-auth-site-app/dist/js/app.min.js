"use strict";angular.module("siteApp",["drupalService","app.site","ui.router","metaInfo","ngSanitize","ngAnimate","ngTouch"]).run(["$rootScope","$state","$stateParams","metaInfo","$window","$location",function($rootScope,$state,$stateParams,metaInfo,$window,$location){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.apiUrl=Drupal.settings.liftoff_auth_site.api_path,$rootScope.uid=Drupal.settings.liftoff_auth_site.uid,$rootScope.pagePath=Drupal.settings.liftoff_auth_site.page_path,$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState){if(toState.data){var title=toState.data.title&&toState.data.title.length?toState.data.title:"";metaInfo.setTitle(title);var description=toState.data.description&&toState.data.description.length?toState.data.description:"";metaInfo.setMetaDescription(description);var keywords=toState.data.keywords&&toState.data.keywords.length?toState.data.keywords:[];metaInfo.setMetaKeywords(keywords,toState.data.keywordAppend)}else fromState.data&&metaInfo.resetAll()}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState){$window.ga&&$window.ga("send","pageview",{page:$location.path(),title:toState.data&&toState.data.title?toState.data.title:"FILLME!"}),fromState.name&&fromState.name.length&&(!toState.data||!toState.data||!toState.data.skipScroll)}),$rootScope.goSubRoute=function(baseRoute,subRoute,baseName){baseName=void 0==baseName?"base":baseName;var stateName=baseRoute+"."+subRoute;try{var state=$state.get(stateName);if(void 0==state||null==state)throw"myException"}catch(e){stateName=baseRoute+"."+baseName}$state.go(stateName)}}]).config(["$locationProvider","$stateProvider","$urlRouterProvider","metaInfoProvider",function($locationProvider,$stateProvider,$urlRouterProvider,metaInfoProvider){metaInfoProvider.setBaseTitle("FILLME!"),metaInfoProvider.setBaseDescription("FILLME!"),metaInfoProvider.setBaseKeywords("FILLME!")}]),angular.module("app.site",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.when("/","/sites"),$stateProvider.state("sites",{url:"/sites",resolve:{nodes:function($stateParams,Node){return Node.query({type:"site",sort:"created",order:"DESC"}).$promise.then(function(data){var nodes=data.list;return angular.forEach(nodes,function(node){1!=node.status?(node.interval=$interval(function(){$http({url:$rootScope.apiUrl+"status/38",method:"GET",cache:!1}).success(function(){node.icon="rocket",$interval.cancel(node.interval)})},1e4),node.icon="rocket fa-spin"):node.icon="helm"==node.field_platform?"circle-o":"rocket"}),nodes})}},templateUrl:"views/sites/list.html",controller:function($scope,$rootScope,$state,$filter,nodes){console.log(nodes),$scope.nodes=nodes,$scope.loadSite=function(node){window.location="http://"+node.field_machine_name+".liftoff.albatrossdigital.com"},$scope.loadCreate=function(){$state["goto"]("create")}}}).state("create",{url:"/create",templateUrl:"views/sites/create.html",controller:function($scope,$rootScope,$state,$filter,$http,Node){void 0==$rootScope.token&&$http({url:$rootScope.apiUrl+"restws/session/token",method:"GET",requestType:"text"}).success(function(data){$rootScope.token=data,console.log("dad",data)}),$scope.name="",$scope.machineName="",$scope.machineFocused=!1,$scope.machineNameClass="",$scope.profile="liftoff",$scope.getMachineName=function(){$scope.machineName=$scope.machineNameFocused&&""!=$scope.machineName?$scope.machineName:$scope.name.replace(/[^a-z0-9]/gi,"-").toLowerCase(),Node.query({type:"site",field_machine_name:$scope.machineName},function(data){$scope.machineNameClass=data.list.length?"has-error":"has-success"})},$scope.submit=function(mlid){if("has-error"==$scope.machineNameClass)return void alert("Sorry, your machine name is already taken.");$scope.activeLink=mlid;var data={type:"site",title:$scope.name,field_machine_name:$scope.machineName,field_profile:$scope.profile};$http({url:$rootScope.apiUrl+"node",dataType:"json",method:"POST",data:data,headers:{"X-CSRF-Token":$rootScope.token,"Content-Type":"application/json"}}).success(function(){$state.go("sites")})}}})}]),angular.module("metaInfo",[]).provider("metaInfo",function(){var baseTitle="",title="",baseMetaDescription="",metaDescription="",baseMetaKeywords="",metaKeywords="";this.setBaseTitle=function(newTitle){baseTitle=newTitle},this.setBaseDescription=function(description){baseMetaDescription=description},this.setBaseKeywords=function(keywords){baseMetaKeywords=keywords},this.$get=function(){return{title:function(){return title.length?title+" | "+baseTitle:baseTitle},setTitle:function(newTitle){title=newTitle},metaDescription:function(){return metaDescription.length?metaDescription:baseMetaDescription},metaKeywords:function(){return metaKeywords.length?metaKeywords:baseMetaKeywords},setMetaDescription:function(newMetaDescription){metaDescription=newMetaDescription},setMetaKeywords:function(newKeywords,append){var keywords="";for(var key in newKeywords)keywords+=", "+newKeywords[key].name;metaKeywords="undefined"!=typeof append&&append?baseMetaKeywords+keywords:keywords},resetAll:function(){title="",metaDescription="",metaKeywords=""}}}}),angular.module("drupalService",["ngResource"]).factory("Token",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"restws/session/token",null,{get:{responseType:"text",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json",console.log("data",data)}}})}]).factory("Node",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"node/:nid",{nid:"@nid"},{get:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0},query:{dataType:"json",method:"GET",cache:!1,isArray:!1},save:{dataType:"json",method:"POST",headers:{"X-CSRF-Token":$rootScope.token,"Content-Type":"application/json"}}})}]).factory("MenuLink",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"menu_link.json",{menu_name:$rootScope.menuName},{query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1}})}]).factory("View",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"rest/:entity/:bundle/:a/:b/:c",{entityType:"@entity",name:"@bundle",a:"@arg0"},{query:{method:"GET",cache:!0,isArray:!0}})}]).factory("TaxonomyTerm",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"taxonomy_term/:tid",{vocabulary:"@vocabulary"},{get:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1},query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1}})}]).factory("TaxonomyTermIndex",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"taxonomy_term?vocabulary&sort=weight&direction=ASC",{vocabulary:"@vocabulary"},{query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1}})}]).factory("TaxonomyTermNodes",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/taxonomy_term_nodes",{tid:"@tid"},{})}]).factory("User",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/user/:uid",{uid:"@uid"},{})}]).factory("Comment",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/node/:nid/comments",{nid:"@nid"},{post:{method:"POST",url:"/entity/comment"}})}]).factory("viewsFactory",["View",function(View){var service={};return service.pageLoad=function($scope,params){if(!$scope.loadingPage&&void 0!=$scope.items&&$scope.items.length>0){$scope.currentPage++;var newData=View.query(params,function(){newData.length>0&&(Array.prototype.push.apply($scope.items,newData),$scope.loadingPage=!1)})}$scope.loadingPage=!0},service}]).directive("openReveal",function(){return{restrict:"A",scope:{openReveal:"@"},link:function($scope,$element){$element.on("click",function(){jQuery("#"+$scope.openReveal).foundation("reveal","open")})}}}),angular.module("metaInfo").controller("metaInfoCtrl",["$scope","metaInfo",function($scope,metaInfo){$scope.pageTitle=function(){return metaInfo.title()},$scope.metaDescription=function(){return metaInfo.metaDescription()},$scope.metaKeywords=function(){return metaInfo.metaKeywords()}}]),angular.module("siteApp").directive("pageReady",function($window,$browser){return{restrict:"A",link:function($scope){$browser.notifyWhenNoOutstandingRequests(function(){document.body.setAttribute("data-status","ready"),$scope.$root.$emit("pageReady"),$scope.$root.$broadcast("pageReady")})}}});